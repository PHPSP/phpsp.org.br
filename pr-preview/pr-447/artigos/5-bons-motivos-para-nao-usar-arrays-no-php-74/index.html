<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="canonical" href="https://phpsp.org.br/artigos/5-bons-motivos-para-nao-usar-arrays-no-php-74" />
    <title>PHPSP | 5 bons motivos para N√ÉO usar arrays no PHP 7.4</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7974451-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-7974451-1');
    </script>

    <link rel="shortcut icon" href="/assets/images/phpsp/favicon.ico"/>
    <link rel="stylesheet" href="/assets/build/css/main.css?id=b46970f13028c511b4b2">
    <script defer src="/assets/build/js/main.js?id=09bbc832a3d0ac409ec2"></script>
</head>
<body>
<section id="app" class="section">
    <div class="container">
        <nav id="navbar" class="navbar has-shadow is-spaced is-fixed-top">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img src="/assets/images/phpsp/phpsp.png" title="PHPSP" alt="PHPSP">
            </a>

                            <a class="navbar-item is-hidden-desktop" href="https://phpsp.org.br/feed.xml" target="_blank">
                    <img src="/assets/images/thirdparty/rss.png"
                         title="RSS" alt="RSS">
                </a>
                            <a class="navbar-item is-hidden-desktop" href="https://twitter.com/phpsp" target="_blank">
                    <img src="/assets/images/thirdparty/Twitter_Social_Icon_Circle_Color.png"
                         title="Twitter" alt="Twitter">
                </a>
                            <a class="navbar-item is-hidden-desktop" href="https://bit.ly/vem-pro-slack-phpsp" target="_blank">
                    <img src="/assets/images/thirdparty/SlackAppIcon.png"
                         title="Slack" alt="Slack">
                </a>
                            <a class="navbar-item is-hidden-desktop" href="https://t.me/phpsp" target="_blank">
                    <img src="/assets/images/thirdparty/telegram.png"
                         title="Telegram" alt="Telegram">
                </a>
            
            <div id="navbarBurger" class="navbar-burger burger" data-target="navMenuComunidade"
                 onclick="document.querySelector('.navbar-menu').classList.toggle('is-active'); document.querySelector('.navbar-burger').classList.toggle('is-active');">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div id="navMenuComunidade" class="navbar-menu">
            <div class="navbar-start">
                <div class="navbar-item has-dropdown is-hoverable">
                    <span class="navbar-link">A Comunidade</span>
                    <div id="moreDropdown" class="navbar-dropdown">
                        <a class="navbar-item " href="/a-comunidade">
                          <span>
                            <strong>A Comunidade PHPSP</strong>
                            <br>
                            O que √© a Comunidade PHPSP
                          </span>
                        </a>

                        <a class="navbar-item " href="/quem-e-a-comunidade">
                          <span>
                            <strong>Quem √© a Comunidade PHPSP</strong>
                            <br>
                            Quem √© a Comunidade PHPSP
                          </span>
                        </a>

                        <hr class="navbar-divider">

                        <a class="navbar-item " href="/codigo-de-conduta">
                          <span>
                            <strong>C√≥digo de Conduta</strong>
                            <br>
                            Codigo de conduta para a comunidade
                          </span>
                        </a>

                    </div>
                </div>

                <a class="navbar-item" href="/artigos">
                    <span>Artigos</span>
                </a>

                <div class="navbar-item has-dropdown is-hoverable">
                    <span class="navbar-link">Eventos</span>
                    <div id="moreDropdown" class="navbar-dropdown">
                                                <a class="navbar-item" href="https://www.meetup.com/php-sp/events/" target="_blank">
                          <span>
                            <strong>PHPSP S√£o Paulo</strong>
                            <br>
                            Eventos na cidade de SP
                          </span>
                        </a>
                                                <a class="navbar-item" href="https://www.meetup.com/phpsp-campinas/events/" target="_blank">
                          <span>
                            <strong>PHPSP Campinas</strong>
                            <br>
                            Eventos na cidade de Campinas
                          </span>
                        </a>
                                                <a class="navbar-item" href="https://www.meetup.com/phpsp-santos/events/" target="_blank">
                          <span>
                            <strong>PHPSP Santos</strong>
                            <br>
                            Eventos na cidade de Santos
                          </span>
                        </a>
                        
                        <hr class="navbar-divider">

                        <a class="navbar-item " href="/codigo-de-conduta-para-eventos">
                          <span>
                            <strong>C√≥digo de Conduta para Eventos</strong>
                            <br>
                            Codigo de conduta para a eventos da comunidade
                          </span>
                        </a>

                    </div>
                </div>

                <div class="navbar-item has-dropdown is-hoverable">
                    <span class="navbar-link">Como Contribuir</span>
                    <div id="moreDropdown" class="navbar-dropdown">
                        <a class="navbar-item" href="/como-contribuir">
                            <span>
                                <strong>Como contribuir?</strong>
                                <br>
                                Que contribuir com a comunidade PHP e n√£o sabe como? Saiba mais!
                              </span>
                        </a>

                        <hr class="navbar-divider">

                        <p class="navbar-item"><strong>Projetos apoiados pelo PHPSP:</strong></p>

                                                    <a class="navbar-item is-white-space-normal" href="https://github.com/PHPSP/php-the-right-way" target="_blank">
                              <span>
                                <strong>PHP The Right Way - BR</strong>
                                <br>
                                Uma refer√™ncia r√°pida de melhores pr√°ticas de PHP, renomados padr√µes de c√≥digo e links para tutoriais competentes pela Web
                              </span>
                            </a>
                                                    <a class="navbar-item is-white-space-normal" href="https://github.com/PHPSP/quero-palestrar" target="_blank">
                              <span>
                                <strong>Quero Palestrar</strong>
                                <br>
                                Reposit√≥rio de palestrantes e propostas de palestras para eventos de tecnologia
                              </span>
                            </a>
                                                    <a class="navbar-item is-white-space-normal" href="https://github.com/PHPSP/zf2-documentation-br" target="_blank">
                              <span>
                                <strong>ZF2 docs - BR</strong>
                                <br>
                                Tradu√ß√£o da Documenta√ß√£o Oficial do Zend Framework
                              </span>
                            </a>
                                            </div>
                </div>

            </div>

            <div class="navbar-end">
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://phpsp.org.br/feed.xml" target="_blank">
                        <img src="/assets/images/thirdparty/rss.png"
                             title="RSS" alt="RSS">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://github.com/phpsp" target="_blank">
                        <img src="/assets/images/thirdparty/GitHub-Mark-120px-plus.png"
                             title="GitHub" alt="GitHub">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://twitter.com/phpsp" target="_blank">
                        <img src="/assets/images/thirdparty/Twitter_Social_Icon_Circle_Color.png"
                             title="Twitter" alt="Twitter">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://bit.ly/vem-pro-slack-phpsp" target="_blank">
                        <img src="/assets/images/thirdparty/SlackAppIcon.png"
                             title="Slack" alt="Slack">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://www.linkedin.com/company/phpsp---php-user-group-in-s-o-paulo/" target="_blank">
                        <img src="/assets/images/thirdparty/In-2C-128px-TM.png"
                             title="LinkedIn" alt="LinkedIn">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://facebook.com/phpsp" target="_blank">
                        <img src="/assets/images/thirdparty/flogo_RGB_HEX-144.png"
                             title="Facebook" alt="Facebook">
                    </a>
                                    <a class="navbar-item is-hidden-touch is-hidden-desktop-only"
                       href="https://t.me/phpsp" target="_blank">
                        <img src="/assets/images/thirdparty/telegram.png"
                             title="Telegram" alt="Telegram">
                    </a>
                            </div>
        </div>
    </div>
</nav>
        <nav class="breadcrumb" aria-label="breadcrumbs">
    <ul>
        <li><a href="/">PHPSP </a></li>

                    <li><a href="/artigos">Artigos</a></li>
        
        <li class="is-active"><a href="#" aria-current="page">5 bons motivos para N√ÉO usar arrays no PHP 7.4</a></li>
    </ul>
</nav>            <section class="section">
        <div class="content">
            <h1 class="title is-1">5 bons motivos para N√ÉO usar arrays no PHP 7.4</h1>
            <p>
                <small>
                    por N√≠ckolas Silva
                    em 12/05/2019
                </small>
            </p>

            <p>A vers√£o do php que ainda est√° por vir, a <code>7.4</code>, est√° cada vez mais rapidamente tomando forma e at√© o presente momento
apresenta novidades muito interessantes para a linguagem que j√° foram confirmadas. Dentre elas:</p>
<ul>
<li><a href="https://wiki.php.net/rfc/preload" rel="nofollow">Preloading</a></li>
<li><a href="https://wiki.php.net/rfc/typed_properties_v2" rel="nofollow">Typed properties</a></li>
<li><a href="https://wiki.php.net/rfc/arrow_functions_v2" rel="nofollow">Short closures</a> (!!)</li>
</ul>
<p>A partir destas atualiza√ß√µes fica cada vez mais clara a inten√ß√£o da comunidade em tornar o php cada vez mais simples de
escrever e confi√°vel na execu√ß√£o. O php est√° reduzindo sua sintaxe ao mesmo passo que reafirma a tipagem e performance.</p>
<p>Ao mesmo tempo <a href="https://hotframeworks.com/languages/php" rel="nofollow">o Laravel continua no topo da lista de Frameworks populares</a>
por diversas raz√µes, dentre elas a facilidade de produzir software com velocidade e qualidade. Com sua sintaxe agrad√°vel
e componentes independentes, o Framework (ou partes dele) acaba conquistando at√© mesmo desenvolvedores mais c√©ticos. Meu
caso.</p>
<p>Animado com a revolu√ß√£o que algumas implementa√ß√µes trouxeram ao blog est√°tico do <a href="https://podentender.com" rel="nofollow">PODEntender</a>
e sedento para atualizar para o php 7.4 assim que sair, eu vim aqui te contar meus <strong>5 motivos para voc√™ NUNCA MAIS usar
arrays a partir do PHP 7.4</strong> mas que voc√™ pode come√ßar a aplicar desde j√°!</p>
<h2>Motivo #1 - Arrays s√£o uma <em>p√©ssima</em> estrutura de dados</h2>
<p>O termo <code>array</code> vem do Latim e significa <code>saco de bagulhos variados que voc√™ n√£o quer se dar o trabalho de armazenar propriamente</code>.</p>
<p>Mentira.</p>
<p>Mas veja, o tipo <code>array</code> √© uma estrutura altamente permissiva que vai agregar qualquer tipo de dado indiscriminadamente.
Num mesmo array voc√™ consegue armazenar inteiros, booleanos, strings, objetos...</p>
<p>Essa estrutura de dados permissiva te torna num(a) eterno(a) namorado(a) ciumento(a) e t√≥xico(a) do seu c√≥digo, tendo
que avaliar cada passo pelo qual ele passa. N√£o seja essa pessoa!</p>
<p>Veja isso:</p>
<pre><code class="language-php">$numeros = ...;

$total = array_sum($numeros);</code></pre>
<p>N√£o sei quanto a voc√™. Mas eu n√£o consigo confiar que <code>$numeros</code> possui apenas tipos num√©ricos.
Me diga a√≠, sem executar o c√≥digo, qual o resultado da soma se n√∫meros fosse o seguinte:</p>
<pre><code class="language-php">$numeros = [0, 10, "1 ma√ß√£", false, "duas bananas"];</code></pre>
<p><strong>N√£o consegue n√©, Mois√©s?</strong></p>
<p>Al√©m disso os √≠ndices dos arrays tamb√©m s√£o muito permissivos. Num array √© poss√≠vel armazenar um valor por chave
num√©rica ou por string. Ou os dois!</p>
<pre><code class="language-php">$arrayLindo = [
    5 =&gt; 'cinco',
    'um',
    'dois' =&gt; '3'
];</code></pre>
<p>Diga√≠ agora: em qual posi√ß√£o do array est√° o valor <code>um</code>?</p>
<p>Portanto a todo momento em que um <code>array</code> se apresenta pra mim, o meu c√≥digo fica automaticamente duas vezes mais
defensivo. Para realizar um <code>array_sum()</code>, por exemplo, eu costumo antes fazer um <code>array_filter()</code> que v√° retirar todos
itens cujo retorno de <code>is_numeric()</code> seja <code>false</code>.</p>
<p>Verifica√ß√µes que eu n√£o precisaria fazer se pudesse confiar nos tipos internos de um array. Itera√ß√µes que todos n√≥s
poder√≠amos evitar.</p>
<p>Assim chegamos ao segundo motivo...</p>
<h2>Motivo #2 - Arrays oferecem performance reduzida em diversos casos</h2>
<p>Comecemos por um princ√≠pio b√°sico: um par√¢metro de fun√ß√£o do tipo <code>object</code>, ou seja, uma inst√¢ncia de classe sempre √©
passado por refer√™ncia. Um par√¢metro de fun√ß√£o do tipo <code>array</code> sempre √© passado por c√≥pia.</p>
<p>O que isso significa em termos pr√°ticos?</p>
<pre><code class="language-php">function arrayFunction(array $param) {
    $param['pos'] = 1;
}

function objectFunction(\stdClass $param) {
    $param-&gt;pos = 1;
}

$array = [];
arrayFunction($array);
var_dump($array); // vazio

$object = new \stdClass();
objectFunction($object);
var_dump($object); // pos = int(1)</code></pre>
<p>Toda vez que voc√™ chamar a fun√ß√£o <code>arrayFunction()</code> e passar um array, o php ir√° fazer uma c√≥pia do array inteiro para
passar para a fun√ß√£o. Este array se mant√©m naquele escopo.</p>
<p>Ao passo que ao passar um objeto como par√¢metro, n√£o √© feita uma c√≥pia, mas passada uma refer√™ncia ao objeto.</p>
<p>Isto significa menos mem√≥ria consumida.</p>
<p>E da√≠?</p>
<p>Da√≠ que existem diversas implementa√ß√µes de cole√ß√£o otimizadas para diversos casos diferentes com as quais voc√™ pode
utilizar menos mem√≥ria, processamento ou os dois.</p>
<p>Vamos ver um exemplo r√°pido usando o <code>SplFixedArray</code>?</p>
<p>O fixed array √© um objeto muito interessante para quando voc√™ sabe o tamanho m√°ximo da sua cole√ß√£o. E √© otimizado para
lidar com os dados que espera receber.</p>
<p>Faz a√≠ no seu computador! Eu vou deixar aqui o tempo que levou pra executar no meu:</p>
<pre><code class="language-php">&lt;?php // array.php
$tamanho = 1000000;
$inicio = microtime(true);
$array = [];

for ($i=0; $i &lt; $tamanho; $i++) {
  $array[] = null;
}

echo (microtime(true) - $inicio) . PHP_EOL; // 0.043247938156128
var_dump(memory_get_peak_usage()); // 33950192</code></pre>
<pre><code class="language-php">&lt;?php // SplFixedArray.php
$tamanho = 1000000;
$inicio = microtime(true);
$fixedArray = new SplFixedArray($tamanho);

for ($i=0; $i &lt; $tamanho; $i++) {
  $fixedArray[$i] = null;
}

echo (microtime(true) - $inicio) . PHP_EOL; // 0.041646957397461
var_dump(memory_get_peak_usage()); // 16394864</code></pre>
<p>O <code>SplFixedArray</code> neste exemplo roda em menos tempo (a diferen√ßa √© inexpressiva, sejamos justos) e utiliza metade da
mem√≥ria para realizar a mesma a√ß√£o. <strong>Metade!</strong></p>
<p>O tipo <code>array</code> traz consigo diversas responsabilidades: iterar, contar, armazenar e acessar por chave.</p>
<p>A analogia do pato se encaixa perfeitamente! Ele anda, voa e nada. Mas n√£o faz nenhum dos tr√™s direito. <strong>O mesmo
acontece com o nosso array</strong>. O <code>SplFixedArray</code> √© especializado em criar cole√ß√µes de tamanho fixo com 16 bytes por
posi√ß√£o e a classe faz isso muito bem!</p>
<p>E olha s√≥, o <code>SplFixedArray</code> tem toda API do <code>Iterator</code> bonitinha implementada, que √© uma API consistente e que segue o
mesmo padr√£o por todos que a implementam, diferente de certos tipos de dados por a√≠... üëÄ</p>
<h2>Motivo #3 - Existem abstra√ß√µes muito mais leg√≠veis e diretas</h2>
<p>E aqui eu falo abertamento do pacote <a href="https://laravel.com/docs/5.8/collections" rel="nofollow">Collection do Laravel</a>. Apesar de n√£o
ser o peda√ßo de c√≥digo mais perform√°tico do mundo, ele apresenta uma API muito agrad√°vel e √© extens√≠vel. Portanto a
parte de performance voc√™ pode consertar se necess√°rio.</p>
<p>Vamos dar uma olhada na diferen√ßa!</p>
<p>Eis aqui uma cole√ß√£o contendo nomes de pessoas e queremos coletar somente pessoas cujo nome tenha mais de 12 caracteres
e transformar cada nome em uma entidade <code>Pessoa</code> do nosso dom√≠nio.</p>
<pre><code class="language-php">$nomes = ['Nome Curto', 'Um nome um pouco maior', 'Outro Curto'];

class Pessoa
{
    public function __construct(string $name)
    {...}
}</code></pre>
<p>Este requisito se traduz em duas opera√ß√µes: <code>filter</code> e <code>map</code>. O nosso filter precisa remover pessoas cujo
<code>strlen($nome)</code> seja menor ou igual a <code>12</code>. Enquanto o <code>map</code> precisa transformar uma <code>string</code> em inst√¢ncia de <code>Pessoa</code>.</p>
<p>Usando a API nativa, ficaria assim:</p>
<pre><code class="language-php">$nomes = ['Nome Curto', 'Um nome um pouco maior', 'Outro Curto'];

// Utilizando short closures: php 7.4
$nomes = array_filter($nomes, fn(string $nome): boolean =&gt; strlen($nome) &lt;= 12);
$nomes = array_map(fn(string $nome): Pessoa =&gt; new Pessoa($nome), $nomes);</code></pre>
<p>Al√©m da confus√£o da posi√ß√£o dos argumentos que faz qualquer programador sem <code>autocomplete</code> pensar duas vezes sobre sua
profiss√£o, n√≥s precisamos atribuir o valor de <code>$nomes</code> tr√™s vezes.</p>
<p>Ainda de uma colher de ch√° e usei <code>array_filter()</code> e <code>array_map()</code>, mas eu sei que quando se trata de arrays a gente
gosta mesmo √© de usar <code>foreach()</code>...</p>
<p>Mas veja s√≥ como o <code>Collection</code> do Laravel trata esse mesmo problema:</p>
<pre><code class="language-php">// Isto √© um exemplo! N√£o use collect()!! Me pergunta no twitter que eu te explico
$nomes = collect(['Nome Curto', 'Um nome um pouco maior', 'Outro Curto'])
    -&gt;filter(fn(string $nome): boolean =&gt; strlen($nome) &lt;= 12)
    -&gt;map(fn(string $nome): Pessoa =&gt; new Pessoa($nome));</code></pre>
<p>Com a API Collection fazemos uma √∫nica atribui√ß√£o, a API √© consistente, o c√≥digo fica claro de in√≠cio e de quebra voc√™
pode optar por implementa√ß√µes diferentes do seu mecanismo de lista que fa√ßam mais sentido e possam ser mais eficientes
no seu caso de uso.</p>
<p>E s√£o exatamente os benef√≠cios da API Collection que contrastam com o motivo 4 a seguir:</p>
<h2>Motivo #4 - A gente nunca sabe que diabos est√° dentro de um array</h2>
<p>No come√ßo do texto eu j√° comentei que um array √© um saco de bagulhos, certo?</p>
<p>J√° a implementa√ß√£o com Collection nos permite tornar a nossa cole√ß√£o especializada em determinado tipo sem muita dor de
cabe√ßa. Uma classe <code>PessoaCollection</code>, por exemplo, nos permite esperar que seus elementos s√£o do tipo <code>Pessoa</code> em vez
de precisarmos testar com <code>is_string</code>, <code>instanceof</code> ou afins cada um dos seus elementos.</p>
<p>√â justamente disso que o <a href="http://bit.ly/php-calisthenics" rel="nofollow">Object Calisthenics</a>
fala no exerc√≠cio de <strong>First class collections</strong>:</p>
<blockquote>
<p>Uma classe que contenha uma lista em suas propriedades, n√£o dever√° possuir outras propriedades.</p>
</blockquote>
<p>Em outras palavras: larga de usar <code>array</code> pra tudo e cria uma classe pra representar sua cole√ß√£o de tipo espec√≠fico!</p>
<p>No caso de Collection tu pode ainda extender a classe e sobrescrever os m√©todos pertinentes pra garantir os tipos
internos da cole√ß√£o, j√° que o PHP n√£o traz consigo Generics.</p>
<p>No estatista do PODEntender eu <a href="https://github.com/PODEntender/estatista/blob/c9c2ed7de0632cafb4cbc807bdb0c09212484bd6/src/Domain/Model/Post/PostCollection.php" rel="nofollow">sequer implementei esta checagem</a>
porque julguei desnecess√°ria. Ao sobrescrever a classe Collection por um tipo espec√≠fico, eu simplesmente adoto por
conven√ß√£o que os tipos internos ser√£o aqueles.</p>
<pre><code class="language-php">class PessoaCollection extends Collection
{}</code></pre>
<p>Diria ao ver uma classe dessa que <code>PessoaCollection</code> √© um conjunto de v√°rios objetos do tipo <code>Pessoa</code>. Portanto poderia
tornar esta classe otimizada para a sua necessidade por implementar uma estrat√©gia espec√≠fica de collection usando o
<code>SplObjectStorage</code>:</p>
<pre><code class="language-php">class PessoaCollection extends SplObjectStorageCollection
{}

class SplObjectStorageCollection extends Collection
{
    private SplObjectStorage $storage;

    // Sobrescrever m√©todos pertinentes
}</code></pre>
<p>Particularmente eu penso que sobrescrever os m√©todos da classe Collection √© um saco. Faria mais sentido Collection ser
uma interface em alguns contextos, mas a forma como foi constru√≠da requer que n√£o. Paci√™ncia, cada projeto entende o que
√© melhor para o seu contexto. </p>
<p>Todo esse esfor√ßo tem uma sa√≠da positiva, por√©m. Para que possamos ter um c√≥digo cada vez mais test√°vel, √© importante
seguir o princ√≠pio da responsabilidade √∫nica. E √© assim que chegamos ao motivo n√∫mero 5:</p>
<h2>Motivo #5 - A sua regra de neg√≥cio n√£o precisa saber como funciona um array!</h2>
<p>Ser√° que a cole√ß√£o precisa crescer? Qual o tamanho esperado? Eu preciso colocar tudo em mem√≥ria ou vou usar como stream?
Eu acesso por chave num√©rica ou string?</p>
<p>Normalmente a gente n√£o repara nisso, mas cole√ß√µes por si s√≥ possuem um dom√≠nio muito espec√≠fico e importante o
suficiente para uma boa modelagem. Quando a gente ignora isso, acaba tomando o caminho curto que, como vimos, pode ser
tamb√©m tortuoso.</p>
<p>Ao tratar nossas cole√ß√µes como os dom√≠nios de respeito que s√£o, passamos tamb√©m a poder depender de interfaces quando se
trata de sua utiliza√ß√£o. Ou melhor dizendo, podemos depender de contratos!</p>
<p>As collections que vimos acima resolvem muita coisa para n√≥s desde seus contratos. Fun√ß√µes como <code>filter()</code> e <code>map()</code>
est√£o sempre presentes. Al√©m de outras muito interessantes como <code>groupBy()</code> e por a√≠ vai. N√£o h√° bons motivos para que
executemos todas essas l√≥gicas em nossas classes de neg√≥cio. (dom√≠nio, services, repositories...)</p>
<p>Al√©m disso, h√° um ganho em extrair a l√≥gica de cole√ß√£o que √© quase √≥bvio mas que vale a pena ser citado:</p>
<blockquote>
<p>Quanto menor o n√∫mero de responsabilidades, mais simples e diretos ser√£o os testes.</p>
</blockquote>
<p>Para finalizar este texto (ufa) eu gostaria de trazer um ultimo exemplo de como a utiliza√ß√£o de collections
especializadas tem se pagado no PODEntender. Se voc√™ abrir <a href="https://github.com/PODEntender/estatista/blob/083231511761cef242e232c743f8febeaef7805e/test/unit/Application/Service/Post/FetchLatestEpisodesTest.php#L26-L43" rel="nofollow">este teste aqui</a>
ser√° direcionado para o seguinte snippet:</p>
<pre><code class="language-php">public function testExecuteFetchesExactAmount(): void
{
    $audioEpisodeCollection = $this-&gt;createDefaultAudioEpisodeCollection()
        -&gt;sortByDesc(function (AudioEpisode $episode) {
            return $episode-&gt;createdAt();
        });

    $this-&gt;postRepository-&gt;withAudio()-&gt;willReturn($audioEpisodeCollection);

    $result = $this-&gt;fetchLatestEpisodesService-&gt;execute(2, null);

    $this-&gt;assertEquals(2, $result-&gt;count());

    $lastEpisode = $result-&gt;first();
    $episodeBeforeLast = $result-&gt;last();

    $this-&gt;assertEquals($audioEpisodeCollection-&gt;take(2)-&gt;first()-&gt;guid(), $lastEpisode-&gt;guid());
    $this-&gt;assertEquals($audioEpisodeCollection-&gt;take(2)-&gt;last()-&gt;guid(), $episodeBeforeLast-&gt;guid());
}</code></pre>
<p><strong>Um m√©todo de teste, 11 linhas de c√≥digo. (Que poderiam ser reduzidas para 5 sem muita perda de legibilidade)</strong></p>
<p>Como o nosso <code>postRepository</code> trabalha com Collections, fazer o mock para seu output √© relativamente simples e direto.
As chamadas ao m√©todo <code>assertEquals()</code> tamb√©m s√£o muito simples e diretas, pois eu posso aqui confiar no contrato da
collection e simplesmente dizer ao teste o que eu espero que aconte√ßa <strong>de forma sem√¢ntica</strong>! </p>
<p>Ainda assim voc√™ pode estar esclamando:</p>
<blockquote>
<p>Ah! Mas eu vou ficar criando classe e for√ßar o php a carregar mais classes atoa? Isso vai aumentar o tempo de execu√ß√£o
por uma quest√£o est√©tica!</p>
</blockquote>
<p>N√£o, n√£o e n√£o. N√£o √© atoa, n√£o vai aumentar o tempo de execu√ß√£o e n√£o √© uma quest√£o puramente est√©tica.</p>
<p>N√£o √© atoa: segregar responsabilidades e tornar sua classe test√°vel s√£o princ√≠pios mais que consolidados na pr√°tica de
desenvolvimento de software.</p>
<p>N√£o vai aumentar o tempo de execu√ß√£o: Ao menos n√£o necessariamente. O php 7.4 traz consigo um mecanismo de preloading
que vai permitir carregar pacotes antes da execu√ß√£o do script e manter isto em cache para execu√ß√µes futuras. Alguns
benchmarks preliminares mostraram <strong>aumento de performance de cerca de 50%</strong> no Zend Framework 2.</p>
<p>N√£o √© uma quest√£o puramente est√©tica: especializar seus componentes em busca de alta coes√£o e baixo acoplamento s√£o
<strong>princ√≠pios de design</strong> que todo software manuten√≠vel deve buscar.</p>
<h2>Conclus√£o</h2>
<p>A vers√£o 7.4 do php traz consigo diversas otimiza√ß√µes de performance e tamb√©m de linguagem. Existe um esfor√ßo conjunto
da comunidade em tornar o seu c√≥digo mais leg√≠vel e perform√°tico. Mas principalmente: tipado!</p>
<p>A utiliza√ß√£o de arrays quando mal feita tende a condenar o seu c√≥digo e a quem mais tiver coragem de tocar nele. Seja em
performance, legibilidade ou at√© mesmo em decis√µes de design.</p>
<p>√â claro que voc√™ n√£o precisa esperar o php 7.4 sair pra parar de usar arrays. O quanto antes voc√™ come√ßar, melhor.</p>
<p>Sinta-se livre pra me perguntar no <a href="http://bit.ly/tw-nawarian" rel="nofollow">Twitter</a> a qualquer momento caso tenha ficado alguma
d√∫vida.</p>
<p>Um x√™ro muito grande e at√© a pr√≥xima!</p>        </div>
    </section>
    <section class="section">
        <div class="container">
            
            <h4 class="title is-4">Mais posts deste Autor</h4>
    <div class="tile is-ancestor">
                    <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/phpeste-2022">PHPeste 2022 em Natal, Rio Grande do Norte</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 20/06/2022</small>
    </p>
</article>            </div>
                                <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/voce-achou-que-sabia-sobre-generators-php">Voc√™ achou que sabia sobre Generators no PHP</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 11/12/2019</small>
    </p>
</article>            </div>
                                <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/como-php-funciona-na-verdade">Como o PHP funciona na verdade</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 19/11/2019</small>
    </p>
</article>            </div>
                </div>
    <div class="tile is-ancestor">
                            <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/tdd-com-php-na-vida-real">TDD na vida real com PHP</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 03/11/2019</small>
    </p>
</article>            </div>
                                <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/ola-php-eu-sou-um-engenheiro">Ol√°, PHP. Eu sou um Engenheiro.</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 29/10/2019</small>
    </p>
</article>            </div>
                                <div class="tile is-parent is-4">
                <article class="tile is-child box">
    <p class="title">
        <a href="/artigos/3-projetos-para-iniciar-no-hacktoberfest-2019">3 Projetos para Iniciar no Hacktoberfest 2019</a>
    </p>
    <p class="subtitle">
        <small> em</small>
        <small> 09/10/2019</small>
    </p>
</article>            </div>
                </div>
    <div class="tile is-ancestor">
                    </div>
        </div>
    </section>
        <div class="container has-text-centered">
    <div class="notification">
        Acha que esse conte√∫do possui erros ou poderia ser aperfei√ßoado?
        <a href="https://github.com/phpsp/phpsp.org.br/blob/master/source/_posts/5-bons-motivos-para-N√ÉO-usar-arrays-no-php-74.md" title="Ajuste esse conte√∫do!" target="_blank">Colabore!</a>
    </div>
</div>    </div>
</section>
</body>

<footer class="footer">
    <div class="content has-text-centered">
        <div class="level is-small">
            <div class="level-item">
                <a href="https://php.net" target="_blank">
                    <figure class="image is-128x128">
                        <img src="/assets/images/sponsors/php.png" title="PHP.net">
                    </figure>
                </a>
            </div>
        </div>

        <div class="level is-small">
            <div class="level-item">
            <a href="https://azure.microsoft.com/pt-br/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/azure.png" title="Microsoft Azure"
                         alt="Microsoft Azure">
                </figure>
            </a>
        </div>
            <div class="level-item">
            <a href="https://imasters.com.br/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/imasters.png" title="iMasters"
                         alt="iMasters">
                </figure>
            </a>
        </div>
            <div class="level-item">
            <a href="https://paypal.com.br/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/paypal.png" title="PayPal"
                         alt="PayPal">
                </figure>
            </a>
        </div>
            <div class="level-item">
            <a href="https://www.locaweb.com.br/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/locaweb.png" title="LocaWeb"
                         alt="LocaWeb">
                </figure>
            </a>
        </div>
    </div>
<div class="level is-small">
            <div class="level-item">
            <a href="https://www.jetbrains.com/phpstorm/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/phpstorm.png" title="PHPStorm"
                         alt="PHPStorm">
                </figure>
            </a>
        </div>
            <div class="level-item">
            <a href="https://contaazul.com/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/contaazul.png" title="ContaAzul"
                         alt="ContaAzul">
                </figure>
            </a>
        </div>
            <div class="level-item">
            <a href="https://devnaestrada.com.br/" target="_blank">
                <figure class="image is-128x128">
                    <img src="/assets/images/sponsors/devnaestrada.png" title="Dev Na Estrada"
                         alt="Dev Na Estrada">
                </figure>
            </a>
        </div>
    </div>

        <hr>
        <p>O site <strong>PHPSP.org.br</strong> foi criado pela <a href="https://github.com/phpsp/phpsp.org.br/graphs/contributors" target="_blank" title="Colaboradores do Site PHPSP.org">Comunidade PHPSP</a>.</p>
        <p>O c√≥digo deste site esta sob a licen√ßa <a href="http://opensource.org/licenses/mit-license.php" target="_blank" title="Licen√ßa MIT">MIT</a> e pode ser encontrado <a href="https://github.com/phpsp/phpsp.org.br/" target="_blank" title="C√≥digo Fonte do Site PHPSP.org.br">aqui</a>.</p>
        <p>O conte√∫do deste site esta sob a licen√ßa <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="Licen√ßa CC BY NC SA 4.0">CC BY NC SA 4.0</a>.</p>
    </div>
</footer>
</html>